USE dbcolegio;

CREATE TABLE Profesor (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre NVARCHAR(50),
    apellido NVARCHAR(50),
    edad INT,
    identificacion NVARCHAR(50),
    tipo_identificacion NVARCHAR(50),
    telefono NVARCHAR(50),
    email NVARCHAR(50),
    genero NVARCHAR(50),
    direccion NVARCHAR(50),
    fecha_nacimiento DATE,
    estado_civil NVARCHAR(50),
    especialidad NVARCHAR(50),
    salario INT,
    fecha_contratacion DATE,
    fecha_terminacion_contrato DATE,
    
    estado_contrato NVARCHAR(50),
    tipo_contrato NVARCHAR(50),
);

CREATE TABLE Grado (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre NVARCHAR(50),
    salon NVARCHAR(50),
    nivel NVARCHAR(50),
    anio DATE,
    jornada NVARCHAR(50),
    cantidad_max_estudiantes INT,
);

CREATE TABLE Seccion (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre NVARCHAR(50),
    horario_inicio TIME,
    horario_final TIME,
    GradoID INT NOT NULL,
    FOREIGN KEY (GradoID) REFERENCES Grado(ID)
);

CREATE TABLE Profesor_grado (
    ProfesorID INT NOT NULL,
    GradoID INT NOT NULL,
    SeccionID INT NOT NULL,
    PRIMARY KEY (ProfesorID, GradoID, SeccionID),
    FOREIGN KEY (ProfesorID) REFERENCES Profesor(ID) ON DELETE CASCADE,
    FOREIGN KEY (GradoID) REFERENCES Grado(ID),
    FOREIGN KEY (SeccionID) REFERENCES Seccion(ID)
);

ALTER TABLE Seccion 
DROP CONSTRAINT IF EXISTS FK_Grado_Seccion;

ALTER TABLE Seccion 
ADD CONSTRAINT FK_Grado_Seccion 
FOREIGN KEY (GradoID) REFERENCES Grado(ID) 
ON DELETE CASCADE;

CREATE TABLE Alumno (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre NVARCHAR(50),
    apellido NVARCHAR(50),
    edad INT,
    InscripcionID INT,
    PadreID INT,
    GradoID INT NOT NULL,
    fecha_registro DATE,
    FOREIGN KEY (GradoID) REFERENCES Grado(ID)
);

CREATE TABLE Alumno_seccion (
    AlumnoID INT NOT NULL,
    SeccionID INT NOT NULL,
    PRIMARY KEY (AlumnoID, SeccionID),
    FOREIGN KEY (AlumnoID) REFERENCES Alumno(ID) ON DELETE CASCADE,
    FOREIGN KEY (SeccionID) REFERENCES Seccion(ID)
);



CREATE TABLE inicio(
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre_usuario NVARCHAR(50) NOT NULL UNIQUE,
    contraseña NVARCHAR(256) NOT NULL
);

-- Insertar el usuario admin con contraseña encriptada 'admin123'
INSERT INTO Usuarios (nombre_usuario, contraseña)
VALUES ('admin', '240be518fabd2724ddb6f04eeb1da5967448d7e831c08c8fa822809f74c720a9'); -- Hash SHA-256 de 'admin123'


-- EJECUTAR CUANDO YA ESTEN LAS TABLAS DE INSCRIPCION Y PADRES
CREATE TABLE Alumno (
    ID INT IDENTITY(1,1) NOT NULL PRIMARY KEY,
    nombre NVARCHAR(50),
    apellido NVARCHAR(50),
    edad INT,
    InscripcionID INT, -- Referencia a la tabla Inscripcion
    PadreID INT,       -- Referencia a la tabla Padre
    GradoID INT NOT NULL,
    FOREIGN KEY (GradoID) REFERENCES Grado(ID) ON DELETE CASCADE, -- Eliminación en cascada al eliminar un Grado
    FOREIGN KEY (PadreID) REFERENCES Padre(ID) ON DELETE CASCADE, -- Eliminación en cascada al eliminar un Padre
    FOREIGN KEY (InscripcionID) REFERENCES Inscripcion(ID) ON DELETE CASCADE -- Eliminación en cascada al eliminar una Inscripción
);